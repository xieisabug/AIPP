<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tauri + React + Typescript</title>
    <script>
        // 主题检测脚本 - 读取用户设置并应用主题，避免闪烁
        (function() {
            try {
                // 从localStorage读取用户的主题设置（由React应用同步）
                const savedThemeMode = localStorage.getItem('theme-mode');
                
                // 检测系统偏好
                const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                // 决定是否应用深色主题
                let shouldApplyDark = false;
                
                if (savedThemeMode === 'dark') {
                    shouldApplyDark = true;
                } else if (savedThemeMode === 'light') {
                    shouldApplyDark = false;
                } else if (savedThemeMode === 'system' || !savedThemeMode) {
                    // 使用系统偏好作为fallback
                    shouldApplyDark = systemPrefersDark;
                }
                
                // 立即应用主题类
                if (shouldApplyDark) {
                    document.documentElement.classList.add('dark');
                }
            } catch (error) {
                // 如果出错，fallback到系统偏好
                const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (systemPrefersDark) {
                    document.documentElement.classList.add('dark');
                }
            }
        })();
    </script>
    <style>
        /* 使用CSS媒体查询确保加载屏幕立即响应系统主题 */
        :root {
            /* 亮色模式的加载屏幕颜色 */
            --loading-bg: #ffffff;
            --loading-text: #666666;
            --loading-spinner-bg: #f3f3f3;
            --loading-spinner-accent: #3498db;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* 深色模式的加载屏幕颜色 */
                --loading-bg: hsl(240, 10%, 3.9%);
                --loading-text: hsl(0, 0%, 98%);
                --loading-spinner-bg: hsl(240, 3.7%, 15.9%);
                --loading-spinner-accent: hsl(224.3, 76.3%, 48%);
            }
        }

        /* 为JavaScript设置的dark类提供覆盖 */
        .dark {
            --loading-bg: hsl(240, 10%, 3.9%);
            --loading-text: hsl(0, 0%, 98%);
            --loading-spinner-bg: hsl(240, 3.7%, 15.9%);
            --loading-spinner-accent: hsl(224.3, 76.3%, 48%);
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--loading-bg);
            transition: background-color 0.2s ease;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: var(--loading-bg);
            transition: opacity 0.3s ease, background-color 0.2s ease;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--loading-spinner-bg);
            border-top: 5px solid var(--loading-spinner-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transition: border-color 0.2s ease;
        }

        .loading-text {
            margin-top: 20px;
            color: var(--loading-text);
            font-size: 16px;
            transition: color 0.2s ease;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #root:not(:empty)+#loading {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <div id="loading">
        <div class="spinner"></div>
        <div class="loading-text">正在加载应用...</div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
</body>

</html>